<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">
  <div class="w-full max-w-2xl p-4 bg-gray-800 rounded-xl shadow-xl">
    <div id="chat-content" class="space-y-4 h-96 overflow-y-auto px-2 py-2 bg-gray-700 rounded-lg mb-4">
      <!-- Messages will be appended here -->
    </div>
    <form id="chat-form" class="flex gap-2">
      <input id="user-input" type="text" placeholder="اكتب رسالتك..." class="flex-1 p-2 rounded-md bg-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" />
      <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md">إرسال</button>
    </form>
  </div>

  <!-- أصوات -->
  <audio id="send-sound" src="https://cdn.pixabay.com/audio/2021/08/04/audio_c2de2c4c32.mp3"></audio>
  <audio id="receive-sound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_26301e5455.mp3"></audio>

  <script>
    const chatContent = document.getElementById("chat-content");
    const chatForm = document.getElementById("chat-form");
    const userInput = document.getElementById("user-input");
    const submitButton = chatForm.querySelector("button");
    const sendSound = document.getElementById("send-sound");
    const receiveSound = document.getElementById("receive-sound");

    function createMessageElement(message, fromUser) {
      const messageElement = document.createElement("div");
      messageElement.classList.add(
        "max-w-md",
        "px-4",
        "py-2",
        "rounded-xl",
        "w-fit",
        "break-words",
        "whitespace-pre-wrap"
      );
      if (fromUser) {
        messageElement.classList.add("bg-blue-500", "text-white", "self-end", "ml-auto");
      } else {
        messageElement.classList.add("bg-white", "text-gray-900", "self-start", "mr-auto");
      }
      messageElement.textContent = message;
      return messageElement;
    }

    async function fetchResponse(userMessage) {
      try {
        const response = await fetch("https://backend.buildpicoapps.com/aero/run/llm-api?pk=v1-Z0FBQUFBQm5IZkJDMlNyYUVUTjIyZVN3UWFNX3BFTU85SWpCM2NUMUk3T2dxejhLSzBhNWNMMXNzZlp3c09BSTR6YW1Sc1BmdGNTVk1GY0liT1RoWDZZX1lNZlZ0Z1dqd3c9PQ==", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ prompt: userMessage }),
        });

        if (!response.ok) {
          console.error("Error:", response.statusText);
          return "حدث خطأ. حاول مرة أخرى لاحقاً.";
        }

        const data = await response.json();
        return data.status === "success" ? data.text : "حدث خطأ في جلب الرد.";
      } catch (error) {
        console.error("Error:", error);
        return "حدث خطأ أثناء الاتصال بالخادم.";
      }
    }

    chatForm.addEventListener("submit", async (event) => {
      event.preventDefault();
      const userMessage = userInput.value.trim();
      if (!userMessage) return;

      const userMsgElem = createMessageElement(userMessage, true);
      chatContent.appendChild(userMsgElem);
      sendSound.play();
      userInput.value = "";
      submitButton.disabled = true;

      const typingMsg = createMessageElement("...يكتب", false);
      chatContent.appendChild(typingMsg);
      chatContent.scrollTop = chatContent.scrollHeight;

      const botResponse = await fetchResponse(userMessage);
      chatContent.removeChild(typingMsg);
      const botMsgElem = createMessageElement(botResponse, false);
      chatContent.appendChild(botMsgElem);
      receiveSound.play();
      chatContent.scrollTop = chatContent.scrollHeight;
      submitButton.disabled = false;

      // حفظ المحادثة في localStorage
      const history = JSON.parse(localStorage.getItem("chatHistory") || "[]");
      history.push({ role: "user", message: userMessage });
      history.push({ role: "bot", message: botResponse });
      localStorage.setItem("chatHistory", JSON.stringify(history));
    });

    // تحميل المحادثة المحفوظة
    window.addEventListener("load", () => {
      const saved = JSON.parse(localStorage.getItem("chatHistory") || "[]");
      for (const msg of saved) {
        chatContent.appendChild(createMessageElement(msg.message, msg.role === "user"));
      }
      chatContent.scrollTop = chatContent.scrollHeight;
    });
  </script>

  <footer class="text-center text-gray-400 mt-4 text-sm">
    © 2025 by Fathei Abdullh. All rights reserved.
  </footer>
</body>
</html>


